" {{{ Pentadactyl configuration   -*- vimrc -*-
"
" Modified by Massimo Lauria 2014
"
" This configuration is supposed to be used on Linux and MacOSX.
" Unfortunately on MacOSX firefox does not get the Alt key. For this
" reason the basic keybindings do not use modifiers. This is probably
" a good idea in any case, since there is no much reason to use
" modifiers while browsing. Another consequences is that few actions
" cannot be performed with keyboards (like scrolling left/right).
" Those actions should be rare enough that resorting to mouse should
" not be a problem.
"
" The rationale is that disruptive actions should have double letter
" (rr, dd, uu, ...).
"
" }}}


" {{{ Options
"

set go=Cs
" No toolbar and scrollbars by default

set complete=bookmark,location
" No toolbar and scrollbars by default

set editor="emacsclient -c"
" C-i invokes editor in text fields

set history=100
" Command line and search patterns history

set incfind
" Show pattern matches as you type

set hlfind
" Hilight previous search pattern matches

set findcase=smart
" Ignore case in search unless pattern has uppercase chars

set showtabline=never
" No tabbar

set showstatuslinks=status
" Show destination links in 1=status line, 2=command line

set hintkeys=asdfg;lkjh

" Small smooth scrolling"
set scrolltime=0
set scrollsteps=5

set! browser.tabs.closeWindowWithLastTab=false
" Do not close the window if last tab is closed.


" Ex commands output in a new tab by default (prefs, addons...)
set newtab=all

" Load external files
loadplugins '\.(js|penta)$'
:source ~/personal/conf/pentadactyl-sensitive
:source ~/config/pentadactyl/user.css


" {{{ Key bindings

:map -builtin <SPACE> :
:map -builtin <A-x> :



" Motion command
:map -builtin  i 4k
:map -builtin  k 4j
:map -builtin  I <PageUp>
:map -builtin  K <PageDown>
:map -builtin  <C-i> <PageUp>
:map -builtin  <C-k> <PageDown>
:map -builtin  <Left>  2h
:map -builtin  <Right> 2l
:map -builtin  <Up>    4k
:map -builtin  <Down>  4j
"------------------------------
:map -builtin  <Home> gg
:map -builtin  <End>  G
"------------------------------
:map -builtin  uu :back<CR>
:map -builtin  oo :forward<CR>
"------------------------------
:map -builtin  j :tabNext<CR>
:map -builtin  l :tabnext<CR>


:map -builtin  gg :open<SPACE>


" Open links (h: normal, H: new tab, <C-h>: new tab background)
:map -builtin  h f
:map -builtin  H ;t
:map -builtin  <C-h> ;b
:map -builtin  f <Nop>
hi -a Hint font-size: 14pt !important;

" Buffer commands
"
" list and swap
:map -builtin  b          :buffer<SPACE>
:map -builtin  <C-x>b     :buffer<SPACE>
:map -builtin  <C-x><C-b> :buffer<SPACE>

" Tabs
:map -builtin  d <Nop>
:map -builtin  D <Nop>
:map -builtin  <C-x>k :tabclose<CR>
:map -builtin  dd :tabclose<CR>
:map -builtin  rr :undo<CR>
:map -builtin  tt :tabopen<SPACE>

" Avoid quit on C-q, and it's more suitable for Stop here
:map -builtin  q     :stop<CR>
:map -builtin  <C-q> :stop<CR>


" Avoid quit commands
:map -builtin  Z <Nop>
:map -builtin  ZZ <Nop>

" Zoom 
:map -builtin  \- ZO
:map -builtin  = ZI
:map -builtin  _ zo
:map -builtin  + zi

" Extended hint mode with M-j
"  ; - focus link, a - save, y - copy link, O - :open query, T - for :tabopen ...
:map -builtin  , ;
:map -builtin  . :


" Use C-s and C-r for searching (n/N for next/prev as in less)
:map -builtin  <C-s> /
:map -builtin  <C-r> ?

" Clipboard
" y - Copy the current URL 
" p - paste the current clipboard as URL
" Y - Copy selected text
" P - paste the current selection to a new buffer

" Edit URL
:map -builtin  e O


" Help
:map -builtin  <C-h>i :help<CR>
:map -builtin  <F1> :help<CR>


" Macro Record and Play
:map -builtin  <F3> q
:map -builtin  <F4> @

" Set a mark at the cursor with C-x r m
:map -builtin  <C-x>rm m

" Jump to the mark in the current buffer with C-x r b
:map -builtin  <C-x>rb '

" C-v was pass-next, remap to bind with default keys
:map -builtin  <C-d> <C-v>
"
" C-x C-f starts the "Open File" dialog (C-x C-s is Save)
map <C-x><C-f> <C-d><C-o>
map <C-x><C-s> <C-d><C-s>



" Bookmarks search, and search by tag
" map <C-c>q :bmarks<SPACE>
" map <C-c>w :bmarks -tags=

" Mail/Rss commands
command -description "Mail reader"  mail :open www.gmail.com
command -description "News reader"  rss  :open digg.com/reader/
command -description "Mail reader"  fb   :open www.facebook.com
command -description "News reader"  tw   :open www.twitter.com


" Frequent websites
command -description "Open mail/rss/twitter input feeds" input :open https://diggg.com/reader/ | https://mail.google.com/mail/ | https://www.twitter.com
command -description "Open starred elements in RSS/Mail" star :open http://www.google.it/reader/view/user/-/state/com.google/starred | http://mail.google.com/mail/#starred


" Unfortunately bookmarklets cannot be saved in Delicious anymore...
" I have to resort to the classical firefox bookmarks, which have to
" be imported into each browser.
"
" Following commands do not work without the bookmarklets. I could
" embed then into the rc file (but then I could use then only in
" firefox + pentadactyl).

" Add a bookmark with C-c a (dialog)
:map -builtin  -description "Save on Delicious" -silent <C-c>a :open delicious-save<CR>
:map -builtin  -description "Save on Delicious" -silent <A-b>  :open delicious-save<CR>
command -description "Open Delicious preferences" dprefs :emenu Strumenti.Delicious Options

" Org-Mode commands (Implemented by bookmarklets)
command -description "Remember in Emacs"   org-remember    :open org-remember
command -description "Capture in Emacs"    org-capture     :open org-capture
command -description "Store Link in Emacs"  org-store-link  :open org-store-link
:map -builtin  -description "Remember in Emacs" -silent <F5> :org-remember<CR>


" Read Later commands (Implemented by bookmarklets)
command -description "Read later on Readability"  rl-readability  :open read-later-readability
command -description "Read later on Instapaper"   rl-instapaper   :open read-later-instapaper
command -description "View in Readability"        readability     :open text-readability
command -description "View in Instapaper"         instapaper      :open text-instapaper

" Defaults
command -description "Make page easy to read (instapaper)" read   :open text-instapaper
command -description "Read later (instapaper)"             later  :open read-later-instapaper
command -description "Send to Kindle (readability)"        kindle :open send-to-kindle-readability

